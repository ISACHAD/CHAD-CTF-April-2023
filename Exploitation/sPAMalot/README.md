# sPAMalot
**Exploitation - Easy**

Wyatt Tauber

## Challenge

Camelot has a new, rather unusual method for allowing it's citizens past the city gates: admit people willy-nilly. King Arthur is almost certain that this is because his knights are lazy and would almost certainly rather spend their time argung about swallows, but he can't figure out what they did to cause this.

SSH as root with whatever and find the source of the problem.

### Hint 1
User authentication in Linux is almost always handled by PAM, the Linux [Pluggable Authentication Modules](https://en.wikipedia.org/wiki/Linux_PAM), at /etc/pam.d.

PAM performs the following functions:

- common-account — Contains a list of PAM ‘modules’ that are used by other services to grant access to the system
- common-auth — Defines general authentication methods that can be used to authenticate to the system
- common-password — Defines shared services used to change passwords
- common-session and common-session-noninteractive— Implements authentication tasks that need to be run at the start of a user’s or service’s session

Look for encoded data.

### Flag
`CHAD{r41s3_th3_g4t3s}`

## Exploit Overview

User authentication in Linux is almost always handled by PAM, the Linux [Pluggable Authentication Modules](https://en.wikipedia.org/wiki/Linux_PAM), at /etc/pam.d. PAM is made up of many files and has incredible depth, which makes it very easy to misconfigure. Such is likely the case for this challenge.
PAM performs the following functions:

- common-account — Contains a list of PAM ‘modules’ that are used by other services to grant access to the system
- common-auth — Defines general authentication methods that can be used to authenticate to the system
- common-password — Defines shared services used to change passwords
- common-session and common-session-noninteractive— Implements authentication tasks that need to be run at the start of a user’s or service’s session

## Implementation Details

Begin by checking the PAM configuration folder at /etc/pam.d for any unusual files.

common-auth handles methods to authenticate to the system. The file uses the three general PAM keywords, sufficient, requisite, and required. PAM processes items in the file in a stack, using the keyword to determine what action to take if one of the authentication items should fail. The possibilities are:

sufficient — If the module returns success, the authentication procedure should be considered successful. The rest of the stack will not be processed.
requisite — If the module returns failure, the authentication process should be considered to have failed. The rest of the stack will not be processed.
required — If the module returns failure, the authentication process will fail if no other item further in the list causes the process to succeed.

The line auth sufficient pam_deny.so is allowing users to log in with any password (the correct setting should be requisite). The flag is above it in a comment:

```
# here's the fallback if no module succeeds - requisite vs sufficient - PUNQ{e41f3_gu3_t4g3f}
auth	sufficient			pam_deny.so
```

Analyzing the strange string at the end of the comment in CyberChef reveals that it is ROT13 for ```CHAD{r41s3_th3_g4t3s}```.
